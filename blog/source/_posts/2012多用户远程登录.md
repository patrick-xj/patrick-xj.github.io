title: windows 2012多用户远程登录
tags:
  - Windows
date: 2020-03-08 12:54:58
---
+ **windows 2012多用户登陆**
  - 默认只允许2个用户同时登录
  - 通过相关配置解决多用户登陆并且打开任务进程互不影响

###### 
<!--more-->

1. **安装桌面会话主机和远程桌面授权**
   1）服务器管理器 -- 添加角色和功能，下一步 -- 基于角色或基于功能的安装，下一步 -- 从服务器池中选择服务器，下一步 -- 远程桌面服务，下一步 -- 下一步 -- 下一步 -- 勾选"远程会话主机"和“远程桌面授权”，下一步 -- 安装 -- 重启服务器生效

2. **Web 申请激活码**
   1）管理工具 -- 远程桌面服务 -- 远程桌面授权管理器 -- 未激活的服务器右键"属性"
```bash 
连接方法
  连接方法：Web浏览器
  记录下:产品ID：00252-20000-06400-AT602
必须信息：
  姓：TEST
  名：TEST
  公司：TEST
  国家：中国
  确定
```
    
   2）IE浏览器输入：https://activate.microsoft.com
```bash
英文界面可选择为中文 go 即跳转到中文
选中：启用许可证服务器，下一步
  产品 ID：输入刚才记录下来的20位ID<00252-20000-06400-AT602> 
  公司：TEST
  国家：中国，下一步 -- 下一步，得到35位许可ID：<PDRVV-B47F4-VFPDY-9FHWF-YRTQV-DQDM7-JGR4Q> 单击：是
  许可证程序：企业协议<如没有许可证，则选择企业协议>，下一步
  产品类型：Windows Server 2012 远程桌面服务每用户客户端访问许可证
  数量：500<根据自己需求设置>
  协议号：如果没有如下号可使用<6565792，4954438，6879321，5296992>，下一步 -- 下一步
  得到另外 ID：KB8KG-9VT7F-XC4JY-CGR6B-8BV62-MB73Y-464D3  ，结束，确定
```

3. **激活终端服务**
   1）管理工具 -- 远程桌面服务 -- 远程桌面授权管理器 -- 选择服务器右键：激活服务器 -- 下一步 -- Web 浏览器,下一步 -- 输入许可服务器ID：<PDRVV-B47F4-VFPDY-9FHWF-YRTQV-DQDM7-JGR4Q>，下一步 -- 下一步 -- 下一步 -- 输入：<KB8KG-9VT7F-XC4JY-CGR6B-8BV62-MB73Y-464D3>,下一步 -- 完成

4. **配置远程桌面会话主机授权服务器**
   1）管理工具 -- 远程桌面服务 -- RD 授权诊断程序 <当前为没有授权>
   2）gpedit.msc -- 计算机配置 -- 管理模板 -- Windows 组件 -- 远程桌面服务 -- 远程桌面会话主机 -- 授权
    找到：使用指定的远程桌面许可服务器，设置为"启用"并设置本机IP或主机名


5. **gpedit.msc 策略配置**
```base 
1) gpedit.msc -- 计算机配置 -- 管理模板 -- windows组件 -- 远程桌面服务 -- 远程桌面会话主机 -- 授权
  找到：设置远程桌面授权模式
    启用
    指定RD：按用户
  重新打开RD授权诊断程序
2）gpedit.msc -- 计算机配置 -- 管理模板 -- windows组件 -- 远程桌面服务 -- 远程桌面会话主机 -- 连接 -- 限制连接的数量
  已启用
  最大连接数：500
3) gpedit.msc -- 计算机配置 -- 管理模板 -- windows组件 -- 远程桌面服务 -- 远程桌面会话主机 -- 连接
  将远程桌面服务限制到单独的远程桌面会话
  禁用  启用较好
4) gpedit.msc -- 计算机配置 -- 管理模板 -- windows组件 -- 远程桌面服务 -- 远程桌面会话主机 -- 会话时间限制
  启用：设置为1分钟（关闭远程管理工具后1分钟后注销用户）
```

6. **关闭不必要端口防止被攻击**
```bash
1) 关闭端口137、138、139、445端口、关闭智能卡。防止0day攻击
  禁止445端口
    本地连接 --> 卸载"Microsoft 网络客户端" "Microsoft 网络的文件和打印机共享" --> 重启系统生效
2) 禁止137、138、139端口
    本地连"”右键 "属性" --> "Internet 协议版本 4（TCP/IPv4）" "属性" --> 高级 --> WINS --> 选择 "禁用 TCP/IP 上的 NetBIOS(S)"
3) 关闭智能卡
    进入 "本地组策略编辑器" （gpedit.msc） --> 计算机配置 --> 管理模板 --> Windows组件 --> 智能卡
      启用智能卡中的证书传播 --> 禁用
      启用智能卡中的根证书传播 --> 禁用
      强制从智能卡读取所有证书 --> 禁用
      打开智能卡即插即用服务 --> 禁用
      重启系统生效
4) 检查端口是否已关闭：netstat -an|findstr xxx
```

7. **禁用windows远程同本地直接复制粘贴数据和其它设置**
```bash
1. C:\Windows\System32\rdpclip.exe 文件 <删除后重启系统确认系统是否能正常启动>
2. 禁止挂载本地磁盘：gpedit.msc –- 计算机配置 — Windows 组件 — 远程桌面服务 — 远程桌面会话主机 — 设备和资源重定向 ---（启用，所有不允许项） ；gpupdate
3. 启用会话时间限制：gpedit.msc –- 计算机配置 — Windows 组件 — 远程桌面服务 — 远程桌面会话主机 — 会话时间限制 -- "设置已中断的时间限制"、"设置RemoteApp回话的注销时间限制"
4. 启用会话时间限制：gpedit.msc –- 计算机配置 — Windows 组件 — 远程桌面服务 — 远程桌面会话主机 — 连接 - 将远程桌面服务用户限制到单独的远程桌面服务回话_启用
```


###### 
